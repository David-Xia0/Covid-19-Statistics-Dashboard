<!DOCTYPE html>

<head>
    <title>COMPSCI 335 Assignment 1!</title>
    <link rel="shortcut icon" href="http://redsox.uoa.auckland.ac.nz/ds/logo.svg" type="image/x-icon" />
    <link rel="stylesheet" href="dxia063.css">

    <script>
        const selectTab = (elementID) => {
            for (element of document.getElementsByClassName('tab')) {
                element.style.backgroundColor = "transparent";
            }

            for (element of document.getElementsByClassName('content')) {
                element.style.display = "none";
            }
            document.getElementById(elementID + "content").style.display = "block";
            document.getElementById(elementID).style.backgroundColor = "grey";

        }


        

        const getNews = () => {
            const fetchPromise = fetch("http://redsox.uoa.auckland.ac.nz/ds/DairyService.svc/news",
                {
                    headers: {
                        "Accept": "application/json",
                    },
                }
            );


            const streamPromise = fetchPromise.then((response) => response.json());
            streamPromise.then((data) => {
                let newsContents = "";

                data.forEach((news) => {
                    newsContents += "<img class=\"productImg\" src=\"" +news.enclosureField.urlField + "\"> <p>" + news.titleField + "</p><p>" + news.descriptionField + "</p><p>" + news.pubDateField + "</p><hr>"
                })
                document.getElementById("DDnewscontent").innerHTML = newsContents;
            });
        }

        const getProducts = (searchKey) => {
            var fetchPromise;
            if (searchKey) {
                fetchPromise = fetch("http://redsox.uoa.auckland.ac.nz/ds/DairyService.svc/search?term={"
                    + document.getElementById("DDproductsearch").value + "}",
                    {
                        headers: {
                            "Accept": "application/json",
                        },
                    }
                );
            } else {
                fetchPromise = fetch("http://redsox.uoa.auckland.ac.nz/ds/DairyService.svc/items",
                    {
                        headers: {
                            "Accept": "application/json",
                        },
                    }
                );
            }

            const streamPromise = fetchPromise.then((response) => response.json());
            streamPromise.then((data) => {
                let itemContents = "";

                data.forEach((item) => {
                    itemContents += "<img class=\"productImg\"src=\"http://redsox.uoa.auckland.ac.nz/ds/DairyService.svc/itemimg?id={" + item.ItemId + "}\"> <p>" + item.Title + "</p> <p>" + item.Price + "</p><p>" + item.Origin + "</p><hr>"
                })
                document.getElementById("DDproductscontentarea").innerHTML = itemContents;
            });

        }
        getProducts();
        getNews();


    </script>
</head>

<body>
    <div style="display: flex;">
        <img src="http://redsox.uoa.auckland.ac.nz/ds/logo.svg" style=" width: 192px; height: 192px;">
        <table style=" height: 192px; width: 100%;">
            <tr style="cursor: pointer;">
                <td id="DDhome" class="tab" onclick="selectTab('DDhome');">
                    🏠
                </td>
                <td id="DDproducts" class="tab" onclick="selectTab('DDproducts');">
                    🛒
                </td>
                <td id="DDlocation" class="tab" onclick="selectTab('DDlocation');">
                    📌
                </td>
                <td id="DDnews" class="tab" onclick="selectTab('DDnews');">
                    📰
                </td>
                <td id="DDguestbook" class="tab" onclick="selectTab('DDguestbook');">
                    📖
                </td>
            </tr>
        </table>
    </div>
    <div>
        <h1>Dunedin Dairy </h1>
    </div>
    <hr>


    <div id="DDhomecontent" class="content" style="display: block;">
        <p> This shop is dairy cool !! </p>
    </div>

    <div id="DDproductscontent" class="content">
        <input id="DDproductsearch" class="productSearch" type="text" placeholder="🔎" oninput="getProducts('serach')"> 
        <div id="DDproductscontentarea" style="text-align: center;">

        </div>
    </div>

    <div id="DDnewscontent" class="content">

    </div>

    <div id="DDlocationcontent" class="content" style=" text-align:  center;">
        <img class="mapImage" src="http://redsox.uoa.auckland.ac.nz/ds/map.png">
    </div>

    <div id="DDguestbookcontent" class="content">
        <p> This guestbook is meh !! </p>
    </div>


</body>

</html>